<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">
		<style type="text/css">.reveal p { text-align: left; }</style>
		<style type="text/css">.reveal blockquote { font-size: 50%; }</style>
		<style type="text/css">.reveal table { font-size: 70%; }</style>
		<style type="text/css">.reveal p img { border: 0px; }</style>
		<style type="text/css">.reveal p.small { font-size: 80%; }</style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">

				<section data-markdown>
# –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –≤ HTTP

–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –ò–Ω—Ç–µ—Ä–Ω–µ—Ç, –ª–µ–∫—Ü–∏—è 11
				</section>

				<section data-markdown>
### –ü–ª–∞–Ω

> –°–µ–∫—Ç–∞ –°–≤–∏–¥–µ—Ç–µ–ª–µ–π –î—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –û—Ç–ª–∏—á–∏—è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –û—Ç –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
> –ò –ò—Ö –û–±–æ–∏—Ö –û—Ç –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

* –ö–∞–∫ —Ä–∞–∑–ª–∏—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
* Cookie
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –≤ HTTP
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
* weel-known URL
				</section>

				<section data-markdown>
### AAA

–û–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
* Identification (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
* Authentication (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
  - —è –∑–Ω–∞—é (–ø–∞—Ä–æ–ª—å)
  - —è –∏–º–µ—é (—Ç–æ–∫–µ–Ω)
  - —è –µ—Å—Ç—å (–±–∏–æ–º–µ—Ç—Ä–∏—è)
* Authorization (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–º–æ—á–∏–π)
  - —Å—É–±—å–µ–∫—Ç + –æ–ø–µ—Ä–∞—Ü–∏—è + –æ–±—ä–µ–∫—Ç -> –¥–∞/–Ω–µ—Ç
* Accounting (—É—á—ë—Ç) + Audit
				</section>

				<section data-markdown>
## Cookies

![](images/cookies-starwars.jpg)
				</section>

				<section data-markdown>
### –ö–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å –ø–µ—á–µ–Ω—å–∫–∏?

[wiki/HTTP_cookie](https://ru.wikipedia.org/wiki/HTTP_cookie#–ò—Å—Ç–æ—Ä–∏—è)
* 1995 –≥, Netscape Communications

RFC 6265 ‚Äì HTTP State Management Mechanism

–ú–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–µ—Ä–µ–Ω—ã (2005 –≥):
* –∫—É–∫–∏, –∫–∞–∫ –≤–∏—Ä—É—Å—ã, –º–æ–≥—É—Ç —Å—Ç–µ—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ
* –∫—É–∫–∏ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏—á–∏–Ω–æ–π –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω
* –∫—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–ø–∞–º–∞
* –∫—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
				</section>

				<section data-markdown>
### –û–±–∑–æ—Ä

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä
```
S -> UA	Set-Cookie: SID=31d4d96e407aad42
UA -> S	Cookie: SID=31d4d96e407aad42
```

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ URL
```
S -> UA	Set-Cookie: SID=31d4d96e407aad42;
			Path=/admin; Domain=example.com
UA -> S	Cookie: SID=31d4d96e407aad42
```

–°–ª–æ–∂–µ–Ω–∏–µ
```
S -> UA	Set-Cookie: SID=31d4d96e407aad42; 
			Path=/admin; Secure; HttpOnly
S -> UA	Set-Cookie: lang=en-US; Path=/
UA -> S	Cookie: SID=31d4d96e407aad42; lang=en-US
```
				</section>

				<section data-markdown>
### Set-Cookie

[Set-Cookie](https://developer.mozilla.org/ru/docs/Web/HTTP/–ó–∞–≥–æ–ª–æ–≤–∫–∏/Set-Cookie): –∏–º—è=–∑–Ω–∞—á–µ–Ω–∏–µ; –∞—Ç—Ä–∏–±—É—Ç—ã
* Expires = Sun, 01 Jan 1970 00:0:00 GMT
* Max-Age = TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
* Domain = example.com
  - –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–¥–æ–º–µ–Ω—ã (www.example.com)
  - UA –ø—Ä–∏–º–µ—Ç –∫—É–∫–∏ –¥–ª—è example.com —Å —Å–µ—Ä–≤–µ—Ä–∞ www.example.com
  - –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –∫—É–∫–∏ –¥–ª—è TLD-–¥–æ–º–µ–Ω–æ–≤
* Path = –ø—É—Ç—å
  - –µ—Å–ª–∏ –Ω–µ—Ç, Path = –∫–∞—Ç–∞–ª–æ–≥ Request URI
* Secure, HttpOnly
				</section>

				<section data-markdown>
### Cookie

Cookie: –∏–º—è=–∑–Ω–∞—á–µ–Ω–∏–µ; –∏–º—è=–∑–Ω–∞—á–µ–Ω–∏–µ
* –ü–æ—Ä—è–¥–æ–∫ –ø–∞—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
* –ù–∞–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç http/https –∏ Secure
* –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫—É–∫–∏

–î–æ–º–µ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ ¬´–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º—É¬ª –≤–∏–¥—É,
–ø—É—Ç—å ‚Äì ¬´–ø–æ–≥–ª–æ—â–∞—é—â–∏–π¬ª

–ù–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä -
4096 –±–∞–π—Ç –Ω–∞ cookie (–∏–º—è+–∑–Ω–∞—á–µ–Ω–∏–µ+–∞—Ç—Ä–∏–±—É—Ç—ã),
–ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ 50 cookies –Ω–∞ –¥–æ–º–µ–Ω,
–ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ 3000 cookies –≤—Å–µ–≥–æ
				</section>

				<section data-markdown>
### –ó–∞—á–µ–º –∏ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–í –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ–º–µ–Ω–∞
* http-—Å–µ—Å—Å–∏—è (—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
* —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–∞–Ω–Ω—ã–µ (–∫–æ—Ä–∑–∏–Ω–∞)
  - —Å–µ–π—á–∞—Å –µ—Å—Ç—å API localStorage

```
&lt;?php session_start();
if (!isset($_SESSION['time'])) {
    $_SESSION['time'] = date("H:i:s");
}
echo $_SESSION['time'];
```

```
Set-Cookie: PHPSESSID=dap83arr6r3b56e0q7t5i0qf91; path=/
```
				</section>

				<section data-markdown>
### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è –∫—É–∫–∞

–í–≤–µ–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ –ª–æ–≥–∏–Ω-–ø–∞—Ä–æ–ª—å –æ–¥–∏–Ω —Ä–∞–∑, —Å–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª Cookie

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–∞–π—Ç–∞ –Ω–∞—Å —É–∂–µ –∑–Ω–∞—é—Ç
* –ø—Ä–∏–º–µ—Ä—ã - –ø–æ—á—Ç–∞, VK, –∏ —Ç.–¥.
* –≤ –ø—Ä–æ—Ñ–∏–ª–µ –æ–±—ã—á–Ω–æ –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ–∞–Ω—Å–æ–≤

–ü—Ä–æ–±–ª–µ–º—ã
* –º–æ–∂–Ω–æ —É–∫—Ä–∞—Å—Ç—å
* CSRF (–ø–æ–¥–¥–µ–ª–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤)
				</section>

				<section data-markdown>
### Cross-Site Request Forgery

–£—è–∑–≤–∏–º–æ—Å—Ç—å ¬´–ø–æ–¥–¥–µ–ª–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤¬ª
* –≤–∏–¥ –∞—Ç–∞–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Å–µ—Å—Å–∏–∏ —Å –∫–∞–∂–¥—ã–º GET/POST-–∑–∞–ø—Ä–æ—Å–æ–º –∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

–°–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏, –æ–¥–Ω–∞–∫–æ —ç—Ç–∞ –æ—à–∏–±–∫–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤–æ –º–Ω–æ–≥–∏—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
				</section>

				<section data-markdown>
### CSRF: –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—É—Å—Ç—å –Ω–∞—à –±–∞–Ω–∫ –∏–º–µ–µ—Ç API :) http://example.com/app/transferFunds?amount=1500&destAccount=12345

–†–∞–∑–º–µ—Å—Ç–∏–º –≥–¥–µ-–Ω–∏–±—É–¥—å –∫–∞—Ä—Ç–∏–Ω–∫—É ... PROFIT !
```
&lt;img src="http://example.com/app/transferFunds?
	amount=1500&destAccount=12345"/&gt;
```

–ê –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ ¬´–æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è¬ª –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –í–ö–æ–Ω—Ç–∞–∫—Ç–µ

–ß–∏—Ç–∞–ª–∏ –∏—Å—Ç–æ—Ä–∏—é ¬´The Spider of Doom¬ª?
www.thedailywtf.com/articles/The_Spider_of_Doom
				</section>

				<section data-markdown>
### CSRF: –∫–∞–∫ –±–æ—Ä–æ—Ç—å—Å—è?

–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ç–æ–∫–µ–Ω –≤ –∫–∞–∂–¥–æ–º HTTP-–∑–∞–ø—Ä–æ—Å–µ
–≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ —Ñ–æ—Ä–º—ã, CMS —á–∞—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç –≤ URL

–ü—Ä–∏–≤—è–∑–∫–∞ cookie –∫ IP/–±—Ä–∞—É–∑–µ—Ä—É –∏ –¥—Ä. 

–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è—Ö, –∏ CAPTCHA

[OWASP/CSRF_Prevention_Cheat_Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)

> –í–µ—Ä–∏—Ç—å –≤ –Ω–∞—à–µ –≤—Ä–µ–º—è –Ω–µ–ª—å–∑—è –Ω–∏–∫–æ–º—É, –ø–æ—Ä–æ–π –¥–∞–∂–µ —Å–∞–º–æ–º—É —Å–µ–±–µ (–ú—é–ª–ª–µ—Ä)
				</section>

				<section data-markdown>
### Cookie: –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–ó–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –¥–æ–º–µ–Ω–∞ - —Å—á—ë—Ç—á–∏–∫, —Å–µ—Ä–≤–∏—Å—ã ¬´–Ø–Ω–¥–µ–∫—Å.–í–µ–±–º–∞—Å—Ç–µ—Ä¬ª, ¬´Google Analytics¬ª 
![](images/http-cookies-stat.png)
![](images/http-cookies-counter.png)
![](images/http-cookies-referer.png)
				</section>

				<section data-markdown>
### Cookie –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

[–î–∏—Ä–µ–∫—Ç–∏–≤—ã –ï–≤—Ä–æ—Å–æ—é–∑–∞](https://www.cookiechoices.org/intl/ru/)

–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–≤ —Ç–æ–º —á–∏—Å–ª–µ cookie) –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –µ—Å–ª–∏:
* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫–∞–∫ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç —ç—Ç–æ–≥–æ
				</section>

				<section data-markdown>
## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –≤ HTTP
				</section>

				<section data-markdown>
### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

RFC 7235 Hypertext Transfer Protocol: Authentication

–°—Ö–µ–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª
* RFC 2617 - Basic –∏ Digest
* RFC 4559 - Negotiate (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–í–Ω–µ—à–Ω–∏–µ
* RFC 5849 - OAuth 
* RFC 6749 - OAuth 2.0
* OpenID, OopenID Connect
				</section>

				<section data-markdown>
### Challenge / Response

```
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Basic realm="simple"
	Newauth realm="admin", type=1,
	title="Login to \"admin\"",
```

```
GET /protected/ HTTP/1.1
Authorization: —Å—Ö–µ–º–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã_–¥–æ—Å—Ç—É–ø–∞
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ
```
HTTP/1.1 407 Proxy Authentication Required
```
				</section>

				<section data-markdown>
### –°—Ö–µ–º–∞ Basic

–ü—Ä–∏–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ https !

```
WWW-Authenticate: Basic realm="admin"
```
–°—Ç—Ä–æ–∫–∞ –∏–∑ Realm –æ–±—ã—á–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
```
Base64 (Aladdin:open sesame)

–ö–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization, –µ—Å–ª–∏ –∫–æ–¥ 401 –∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –¥–æ–º–µ–Ω –∏ realm
				</section>

				<section data-markdown>
### –°—Ö–µ–º–∞ Digest

```
WWW-Authenticate: Digest digest-challenge
```

```
digest-challenge = realm [domain] nonce [opaque]
	[stale] [algorithm] [qop-options] [auth-param]
```

–í –ø—Ä–æ—Å—Ç–µ–π—à–µ–º —Å–ª—É—á–∞–µ (¬´–∫–∞—á–µ—Å—Ç–≤–æ –∑–∞—â–∏—Ç—ã¬ª QoP –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)
$$ ùêªùê¥1=ùëÄùê∑5(ùê¥1)=ùëÄùê∑5(ùë¢ùë†ùëíùëüùëõùëéùëöùëí:ùëüùëíùëéùëôùëö:ùëùùëéùë†ùë†ùë§ùëúùëüùëë) $$

$$ ùêªùê¥2=ùëÄùê∑5(ùê¥2)=ùëÄùê∑5(ùëöùëíùë°‚Ñéùëúùëë:ùëëùëñùëîùëíùë†ùë°ùëàùëÖùêº) $$
$$ ùëüùëíùë†ùëùùëúùëõùë†ùëí=ùëÄùê∑5(ùêªùê¥1:ùëõùëúùëõùëêùëí:ùêªùê¥2) $$
				</section>

				<section data-markdown>
### –°—Ö–µ–º–∞ Digest


```
digest-challenge = realm [domain] nonce [opaque]
	[stale] [algorithm] [qop-options] [auth-param]
```

–ï—Å–ª–∏ QoP = auth-int
$$ ùëüùëíùë†ùëùùëúùëõùë†ùëí=ùëÄùê∑5(ùêªùê¥1:ùëõùëúùëõùëêùëí:ùëõùëúùëõùëêùëíùê∂ùëúùë¢ùëõùë°: $$ $$ ùëêùëôùëñùëíùëõùë°ùëÅùëúùëõùëêùëí:ùëûùëúùëù:ùêªùê¥2)$$
				</section>

				<section data-markdown>
### –°—Ö–µ–º–∞ Digest

```
GET /dir/index.html HTTP/1.1

HTTP/1.1 401 Unauthorized
WWW-Authenticate: Digest
	realm="testrealm@host.com",
	qop="auth,auth-int",
	nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",
	opaque="5ccc069c403ebaf9f0171e9517f40e41‚Äú

GET /dir/index.html HTTP/1.1
Authorization: Digest username="Mufasa",
	realm="testrealm@host.com",
	nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",
	uri="/dir/index.html",
	qop=auth,
	nc=00000001,
	cnonce="0a4f113b",
	response="6629fae49393a05397450978507c4ef1",
	opaque="5ccc069c403ebaf9f0171e9517f40e41"
```
				</section>

				<section data-markdown>
### –í–æ–∑–º–æ–∂–Ω—ã–µ –∞—Ç–∞–∫–∏

Replay Attacks
* nonce –º–æ–∂–µ—Ç –æ—Å–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–∞ IP –∫–ª–∏–µ–Ω—Ç–∞, –¥–∞—Ç–µ, Etag –∏ private server key

Man in the Middle
* –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Basic-–ø—Ä–æ–≤–µ—Ä–∫—É

Dictionary / Rainbow tables / Brute force

–ù–µ —Ö—Ä–∞–Ω–∏–º –ø–∞—Ä–æ–ª—å –≤ plaint text ?
				</section>

				<section data-markdown>
## –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
				</section>

				<section data-markdown>
![](images/http-auth-traditional.jpg) —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ

![](images/http-auth-openid.jpg) –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
				</section>

				<section data-markdown>
### OpenID

–°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
* OpenID 1.1
* OpenID 2.0
* OpenID Connect

[OpenId Specifications](openid.net/developers/specs),
[Google/identity](developers.google.com/identity)
				</section>

				<section data-markdown>
### OAuth

–ü—Ä–æ—Ç–æ–∫–æ–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç—Ä–µ—Ç—å–µ–π —Å—Ç–æ—Ä–æ–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –µ–π (—Ç—Ä–µ—Ç—å–µ–π —Å—Ç–æ—Ä–æ–Ω–µ) –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å

–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - access token (–Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤), –ø—Ä–µ–¥—ä—è–≤–ª–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–ø—É—Å–∫–æ–º –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º

–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–∏–º –ø–æ HTTPS —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∏–ª–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ access token
				</section>

				<section data-markdown>
### OAuth

–î–∞–ª–µ–µ –ø–æ–¥ Oauth –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è 2

[RFC 6749](https://tools.ietf.org/html/rfc6749) OAuth 2.0 Framework

[RFC 8252](https://tools.ietf.org/html/rfc8252) OAuth 2.0 for Native Apps

–°–ø–∏—Å–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ - [oauth.net/2](https://oauth.net/2/)

–ü—Ä–∏–º–µ—Ä—ã:
* [yandex.ru/dev/passport](https://yandex.ru/dev/passport/)
* [vk.com/dev/access_token](https://vk.com/dev/access_token)

Note:
https://habr.com/ru/post/115163/
				</section>

				<section data-markdown>
### –†–æ–ª–∏ OAuth

OAuth –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —á–µ—Ç—ã—Ä–µ —Ä–æ–ª–∏
* –í–ª–∞–¥–µ–ª–µ—Ü —Ä–µ—Å—É—Ä—Å–∞ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
* –ö–ª–∏–µ–Ω—Ç - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  - –¥–æ—Å—Ç—É–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏ (scope) 
* –°–µ—Ä–≤–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤, Resource Server (Provider)
  - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API
* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä 
  - —á–∞—Å—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–æ–º —Ä–µ—Å—É—Ä—Å–æ–≤
				</section>

				<section data-markdown>
![](images/oauth-abstract.png)
				</section>

				<section data-markdown>
### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OAuth –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ (RS, AS),
–ø—Ä–∏—Å–≤–æ–∏—Ç—å client ID, –∏–Ω–æ–≥–¥–∞ client secret

* –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
* –°–∞–π—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
* Redirect URL / Callback URL
  - —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–ª–∏ –æ—Ç–∫–∞–∑–∞ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
				</section>

				<section data-markdown>
### –û–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

Scope - –Ω–∞–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤

OAuth –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–∞–≤ –¥–µ–π—Å—Ç–≤–∏–π –∏ –Ω–∞–∑–≤–∞–Ω–∏—è

–ü—Ä–∏–º–µ—Ä—ã
* [Slack](https://api.slack.com/scopes)
  - chat:write, dnd:read, groups:history –∏ —Ç.–¥.
* [Github](https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/)
  - repo:status, write:public_key –∏ —Ç.–¥.
* [FitBit](https://dev.fitbit.com/build/reference/web-api/oauth2/#scope)
  - activity, heartrate, location –∏ —Ç.–¥.
				</section>

				<section data-markdown>
### –°—Ö–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

* Authorization Code / Code Flow
  - –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π c —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç—å—é
* [PKCE](https://tools.ietf.org/html/rfc7636), Proof Key for Code Exchange
* Client Credentials
* Device Code
* Refresh Token
  - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
* Legacy: Implicit Flow
  - –¥–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
* Legacy: Password Grant
  - –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é
				</section>

				<section data-markdown>
### Authorization Code / Code Flow

–°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Ç–∏–ø —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

–•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≥–¥–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å–µ–∫—Ä–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º

–ü—Ä–æ—Ü–µ—Å—Å —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (redirection), HTTP 3xx

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å UA (–±—Ä–∞—É–∑–µ—Ä–æ–º)
–∏ –ø–æ–ª—É—á–∞—Ç—å –∫–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ API, ¬´—Å–ª—É—à–∞—è¬ª Redirect URL
				</section>

				<section data-markdown>
![](images/oauth-code-flow.png)
				</section>

				<section data-markdown>
### Code Flow (—à–∞–≥–∏ 1-3)

–≠—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ - –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, 
scope –≤ –ø—Ä–∏–º–µ—Ä–µ - –Ω–µ–∫–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

![](images/oauth-button.png)
```
GET /oauth/authorize?response_type=code&client_id=464119
	&redirect_uri=http%3A%2F%2Fexample.com%2Fu123%2F HTTP/1.1
Host: connect.mail.ru
```

–î–æ–ø—É—Å—Ç–∏–º—ã–µ redirect_uri - –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
```
HTTP/1.1 302 Found
Location: http://example.com/u123/?code=DoRieb0y
```
—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø—Ä–æ—Ç–∏–≤ CSRF-–∞—Ç–∞–∫ - u123
				</section>

				<section data-markdown>
### Code Flow (—à–∞–≥–∏ 4,5)

–≠—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ - –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```
POST /oauth/token HTTP/1.1
Host: connect.mail.ru
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&client_id=464119&client_secret=xxx&
code=DoRieb0y&redirect_uri=http%3A%2F%2Fexample.com%2Fu123
```

```
HTTP/1.1 200 OK
Content-Type: application/json

{
	"access_token":"SlAV32hkKG",
	"token_type":"bearer",
	"expires_in":3600,
	"refresh_token":"8xLOxBtZp8",
}
```

[Bearer Token](https://tools.ietf.org/html/rfc6750), ¬´–Ω–∞ –ø—Ä–µ–¥—ä—è–≤–∏—Ç–µ–ª—è¬ª / MAC Token

				</section>

				<section data-markdown>
### –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

```
GET /platform/api?oauth_token=SlAV32hkKG&
	client_id=464119&format=json&
	method=users.getInfo&sig=... HTTP/1.1
Host: appsmail.ru
```

–°–µ—Ä–≤–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–≤–µ—Ä—è–µ—Ç
* —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞
* –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ scope)

–¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –Ω–µ –≤ URL
				</section>

				<section data-markdown>
### –ó–∞—á–µ–º Refresh Token

* access token - –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ —Å–µ—Ä–≤–µ—Ä—É
  - –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–π –∏ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π
* refresh token - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access –∏ refresh
  - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∏ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π

–°—Ö–µ–º–∞ refresh + access –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –∞—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø

–°–ª—É—á–∞–π 1: –ë–æ–± —É–∑–Ω–∞–ª –æ–±–∞ —Ç–æ–∫–µ–Ω–∞ –ê–ª–∏—Å—ã –∏ –Ω–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è refresh

–°–ª—É—á–∞–π 2: –ë–æ–± —É–∑–Ω–∞–ª –æ–±–∞ —Ç–æ–∫–µ–Ω–∞ –ê–ª–∏—Å—ã –∏ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è refresh
				</section>

				<section data-markdown>
### Implicit Flow

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–û—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
* —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–¥–∞—á–∏ –ø—Ä–∞–≤
* –≤ —Å–ª—É—á–∞–µ —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±—Ä–∞—É–∑–µ—Ä —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É-–∑–∞–≥–ª—É—à–∫—É
  - –≤ URL –ø–æ—Å–ª–µ # –ø–∏—à–µ—Ç—Å—è access token
  - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç –∏–∑ –∞–¥—Ä–µ—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã access token
				</section>

				<section data-markdown>
![](images/oauth-implicit-flow.png)
				</section>

				<section data-markdown>
### Implicit Flow (—à–∞–≥–∏ 1-3)

–ó–∞–ø—Ä–æ—Å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º response_type
```
GET /oauth/authorize?response_type=token&client_id=464119 HTTP/1.1
Host: connect.mail.ru
```

–ï—Å–ª–∏ –Ω–µ—Ç redirect_uri, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ¬´—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π¬ª
```
HTTP/1.1 302 Found
Location: http://connect.mail.ru/oauth/success.html
	#access_token=FJQbwq9&token_type=bearer&
	expires_in=3600&refresh_token=yaeFa0gu
```
				</section>

				<section data-markdown>
### OpenId Connect

–ü—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç OpenId –≤–µ—Ä—Å–∏–π 1/2

[openid.net/connect](https://openid.net/connect/)

–ù–∞–¥—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥ OAuth, –æ–ø–∏—Å–∞–Ω—ã API –∏ scope

API –≤–∫–ª—é—á–∞–µ—Ç
* Authorization endpoint
* Token Endpoint
* Userinfo Endpoint
* CheckId Endpoint (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
* Registration Endpoint (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
				</section>

				<section data-markdown>
### –ü–æ–∏—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ OpenId

–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ (site-wide metadata)

–†–∞–Ω–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏ - [robots.txt](http://www.robotstxt.org/), –º–µ—Ç–æ–¥ [PROPFIND](https://tools.ietf.org/html/rfc4918)

[RFC 8615](https://tools.ietf.org/html/rfc8615) Well-Known Uniform Resource Identifiers

[iana.org/assignments/well-known-uris](https://www.iana.org/assignments/well-known-uris/)
* /.well-known/acme-challenge
* /.well-known/caldav
* /.well-known/openid-configuration
* /.well-known/webfinger
				</section>

				<section data-markdown>
### WebFinger

–ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–Ω/email)
–∏—Å–ø–æ–ª—å–∑—É–µ–º WebFinger,
[RFC 7033](https://tools.ietf.org/html/rfc7033)

```
GET /.well-known/webfinger?resource=acct%3Ajoe%40example.com&
	rel=http%3A%2F%2Fopenid.net%2Fspecs%2Fconnect%2F1.0%2Fissuer HTTP/1.1
Host: example.com
```

```
HTTP/1.1 200 OK
Content-Type: application/jrd+json
{
"subject": "acct:joe@example.com",
"links":
    [{
    "rel": "http://openid.net/specs/connect/1.0/issuer",
    "href": "https://server.example.com"
    }]
}
```
				</section>

				<section data-markdown>
### openid-configuration

–î–∞–ª–µ–µ - –∑–∞–ø—Ä–æ—Å –∫ —ç–º–∏—Ç–µ–Ω—Ç—É
```
GET /.well-known/openid-configuration HTTP/1.1
Host: server.example.com
```

–ü–æ–ª—É—á–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```
{
    "authorization_endpoint": "https://server.example.com/connect/authorize",
    "issuer" : "https://server.example.com",
    "token_endpoint": "https://server.example.com/connect/token",
    "token_endpoint_auth_types_supported":["client_secret_basic", "private_key_jwt"],
    "userinfo_endpoint": "https://server.example.com/connect/user",
    "check_id_endpoint": "https://server.example.com/connect/check_id",
    "registration_endpoint": "https://server.example.com/connect/register"
}
```
				</section>

				<section data-markdown>
### –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ OIDC

id_token - –Ω–æ–≤—ã–π —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞
* Implicit: response_type=id_token (id_token%20token)
* Code: grant_type=id_token (id_token%20token)

```
GET /authorize?grant_type=token%20id_token&scope=openid%20profile&
	redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1
Host: server.example.com
```
				</section>

				<section data-markdown>
### OpenId scope

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π scope=openid
* –≤ –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –ø–æ–ª–µ sub (Subject Identifier)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
* profile = name, family_name, given_name, middle_name, nickname, preferred_username, profile, picture, website, gender, birthdate, zoneinfo, locale, and updated_at.
* email
* phone
				</section>

				<section data-markdown>
### JSON Web Token

–û—Ç–≤–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ JWT (JSON Web Token), [RFC 7519](https://tools.ietf.org/html/rfc7519)
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
```

–ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å - –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω Base64url
```
{ "alg": "HS256", "typ": "JWT"}
```
–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å - –ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (Payload)
```
{
	"sub": "1234567890",
	"name": "John Doe",
	"admin": true
}
```
–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å - —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å (–∑–¥–µ—Å—å - HS256)
				</section>

				<section data-markdown>
### UserInfo

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –≤—Ä—É—á–Ω—É—é
```
curl -v -H 'Authorization: bearer –¢–û–ö–ï–ù'
	https://auth.usaaa.ru/auth/realms/master/protocol/openid-connect/userinfo 
```

```
{
	"sub":"f:a1785221-ee0b-4fc9-9c43-627b2a05d19e:–í–æ–ª–∫–∞–Ω–∏–Ω –õ–µ–æ–Ω–∏–¥ –°–µ—Ä–≥–µ–µ–≤–∏—á",
	"email_verified":true,
	"name":"–õ–µ–æ–Ω–∏–¥ –í–æ–ª–∫–∞–Ω–∏–Ω",
	"preferred_username":"volkanin",
	"given_name":"–õ–µ–æ–Ω–∏–¥",
	"family_name":"–í–æ–ª–∫–∞–Ω–∏–Ω",
	"email":"lsv@usaaa.ru"
}
```
				</section>

				<section data-markdown>
# –í–æ–ø—Ä–æ—Å—ã ?
				</section>

			</div>
		</div>
		<script src="js/reveal.js"></script>
		<script>
			Reveal.initialize({
				hash: true,
				slideNumber: true,
				center: false,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/math/math.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
